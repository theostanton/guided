fragment GuideInfo on Guide{
    id
    title
    slug
    startDate
    owner
}

subscription GuideInfos($owner:String!){
    guides(
        filter: {owner: {
            equalTo: $owner
        }}
    ){
        nodes{
            ...GuideInfo
        }
    }
}

fragment GuideFeedItem on Guide {
    id
    title
    slug
    startDate
    updated
    created
    owner:userByOwner{
        username
        colour
    }
    rides:ridesByGuide{
        nodes{
            distanceMeters
            durationSeconds
        }
    }
    stages:stagesByGuide{
        totalCount
    }
    spots:spotsByGuide{
        totalCount
        nodes{
            nights
        }
    }
}

subscription Feed{
    items:query{
        newGuides:guides(
            orderBy: [CREATED_DESC]
        ){
            nodes{
                ...GuideFeedItem
            }
        }
        updatedGuides:guides(
            orderBy: [UPDATED_DESC]
        ){
            nodes{
                ...GuideFeedItem
            }
        }
    }
}

fragment Spot on Spot{
    id
    label
    lat
    name
    long
    locked
    location
    position
    date
    temperature
    country
    nights
}

fragment Ride on Ride{
    id
    position
    status
    toSpot:spotByToSpot{
        ...Spot
    }
    fromSpot:spotByFromSpot{
        ...Spot
    }
    pathUrl
    hasBorder
    name
    date
    distanceMeters
    durationSeconds
}

fragment Stage on Stage {
    id
    position
    status
    name
    toSpot:spotByToSpot{
        ...Spot
    }
    fromSpot:spotByFromSpot{
        ...Spot
    }
    ridesByStage(orderBy: [POSITION_ASC]){
        nodes{
            ...Ride
        }
    }
}

fragment Guide on Guide {
    id
    slug
    owner
    startDate
    title
    maxHoursPerRide
    firstSpot:spotsByGuide(filter: {position: {equalTo: "0.0"}}){
        nodes{
            ...Spot
        }
    }
    stages:stagesByGuide(orderBy: POSITION_ASC){
        nodes{
            ...Stage
        }
    }
}

subscription GuideStages($id: String!){
    guide(
        id: $id
    ){
        ...Guide
    }
}

fragment Profile on User {
    colour
    username
    created
    guides:guidesByOwner{
        totalCount
    }
    rides:ridesByOwner{
        totalCount
        nodes{
            distanceMeters
            durationSeconds
        }
    }
}

subscription UserProfile($username:String!){
    profile:user(username: $username){
        ...Profile
    }
}

query GuideStagesPublic($id: String!){
    guide(
        id: $id
    ){
        ...Guide
    }
}