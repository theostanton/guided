{"ast":null,"code":"\"use strict\";var _interopRequireDefault2=require(\"@babel/runtime/helpers/interopRequireDefault\");var _classCallCheck2=_interopRequireDefault2(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault2(require(\"@babel/runtime/helpers/createClass\"));var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");exports.__esModule=true;exports.default=void 0;var _url=require(\"url\");var _mitt=_interopRequireDefault(require(\"../next-server/lib/mitt\"));var _isDynamic=require(\"./../next-server/lib/router/utils/is-dynamic\");var _routeMatcher=require(\"./../next-server/lib/router/utils/route-matcher\");var _routeRegex=require(\"./../next-server/lib/router/utils/route-regex\");var _router=require(\"./../next-server/lib/router/router\");function hasRel(rel,link){try{link=document.createElement('link');return link.relList.supports(rel);}catch(_unused){}}var relPrefetch=hasRel('preload')&&!hasRel('prefetch')?'preload':'prefetch';var hasNoModule=('noModule'in document.createElement('script'));function normalizeRoute(route){if(route[0]!=='/'){throw new Error(\"Route name should start with a \\\"/\\\", got \\\"\"+route+\"\\\"\");}route=route.replace(/\\/index$/,'/');if(route==='/')return route;return route.replace(/\\/$/,'');}function appendLink(href,rel,as){return new Promise(function(res,rej,link){link=document.createElement('link');link.crossOrigin=process.crossOrigin;link.href=href;link.rel=rel;if(as)link.as=as;link.onload=res;link.onerror=rej;document.head.appendChild(link);});}var PageLoader=function(){function PageLoader(buildId,assetPrefix){(0,_classCallCheck2.default)(this,PageLoader);this.buildId=buildId;this.assetPrefix=assetPrefix;this.pageCache={};this.pageRegisterEvents=(0,_mitt.default)();this.loadingRoutes={};if(process.env.__NEXT_GRANULAR_CHUNKS){this.promisedBuildManifest=new Promise(function(resolve){if(window.__BUILD_MANIFEST){resolve(window.__BUILD_MANIFEST);}else{window.__BUILD_MANIFEST_CB=function(){resolve(window.__BUILD_MANIFEST);};}});}this.promisedSsgManifest=new Promise(function(resolve){if(window.__SSG_MANIFEST){resolve(window.__SSG_MANIFEST);}else{window.__SSG_MANIFEST_CB=function(){resolve(window.__SSG_MANIFEST);};}});}(0,_createClass2.default)(PageLoader,[{key:\"getDependencies\",value:function getDependencies(route){var _this=this;return this.promisedBuildManifest.then(function(man){return man[route]&&man[route].map(function(url){return _this.assetPrefix+\"/_next/\"+encodeURI(url);})||[];});}},{key:\"getDataHref\",value:function getDataHref(href,asPath){var _this2=this;var getHrefForSlug=function getHrefForSlug(path){path=(0,_router.delBasePath)(path);return _this2.assetPrefix+\"/_next/data/\"+_this2.buildId+(path==='/'?'/index':path)+\".json\";};var _ref=(0,_url.parse)(href,true),hrefPathname=_ref.pathname,query=_ref.query;var _ref2=(0,_url.parse)(asPath),asPathname=_ref2.pathname;var route=normalizeRoute(hrefPathname);var isDynamic=(0,_isDynamic.isDynamicRoute)(route),interpolatedRoute;if(isDynamic){var dynamicRegex=(0,_routeRegex.getRouteRegex)(route);var dynamicGroups=dynamicRegex.groups;var dynamicMatches=(0,_routeMatcher.getRouteMatcher)(dynamicRegex)(asPathname)||query;interpolatedRoute=route;if(!Object.keys(dynamicGroups).every(function(param){var value=dynamicMatches[param];var repeat=dynamicGroups[param].repeat;if(repeat&&!Array.isArray(value))value=[value];return param in dynamicMatches&&(interpolatedRoute=interpolatedRoute.replace(\"[\"+(repeat?'...':'')+param+\"]\",repeat?value.map(encodeURIComponent).join('/'):encodeURIComponent(value)));})){interpolatedRoute='';}}return isDynamic?interpolatedRoute&&getHrefForSlug(interpolatedRoute):getHrefForSlug(route);}},{key:\"prefetchData\",value:function prefetchData(href,asPath){var _this3=this;var _ref3=(0,_url.parse)(href,true),hrefPathname=_ref3.pathname;var route=normalizeRoute(hrefPathname);return this.promisedSsgManifest.then(function(s,_dataHref){return s.has(route)&&(_dataHref=_this3.getDataHref(href,asPath))&&!document.querySelector(\"link[rel=\\\"\"+relPrefetch+\"\\\"][href^=\\\"\"+_dataHref+\"\\\"]\")&&appendLink(_dataHref,relPrefetch,'fetch');});}},{key:\"loadPage\",value:function loadPage(route){return this.loadPageScript(route);}},{key:\"loadPageScript\",value:function loadPageScript(route){var _this4=this;route=normalizeRoute(route);return new Promise(function(resolve,reject){var fire=function fire(_ref4){var error=_ref4.error,page=_ref4.page,mod=_ref4.mod;_this4.pageRegisterEvents.off(route,fire);delete _this4.loadingRoutes[route];if(error){reject(error);}else{resolve({page:page,mod:mod});}};var cachedPage=_this4.pageCache[route];if(cachedPage){var error=cachedPage.error,page=cachedPage.page,mod=cachedPage.mod;error?reject(error):resolve({page:page,mod:mod});return;}_this4.pageRegisterEvents.on(route,fire);if(document.querySelector(\"script[data-next-page=\\\"\"+route+\"\\\"]\")){return;}if(!_this4.loadingRoutes[route]){_this4.loadingRoutes[route]=true;if(process.env.__NEXT_GRANULAR_CHUNKS){_this4.getDependencies(route).then(function(deps){deps.forEach(function(d){if(/\\.js$/.test(d)&&!document.querySelector(\"script[src^=\\\"\"+d+\"\\\"]\")){_this4.loadScript(d,route,false);}if(/\\.css$/.test(d)&&!document.querySelector(\"link[rel=stylesheet][href^=\\\"\"+d+\"\\\"]\")){appendLink(d,'stylesheet').catch(function(){});}});_this4.loadRoute(route);});}else{_this4.loadRoute(route);}}});}},{key:\"loadRoute\",value:function loadRoute(route){route=normalizeRoute(route);var scriptRoute=route==='/'?'/index.js':route+\".js\";var url=this.assetPrefix+\"/_next/static/\"+encodeURIComponent(this.buildId)+\"/pages\"+encodeURI(scriptRoute);this.loadScript(url,route,true);}},{key:\"loadScript\",value:function loadScript(url,route,isPage){var _this5=this;var script=document.createElement('script');if(process.env.__NEXT_MODERN_BUILD&&hasNoModule){script.type='module';if(isPage)url=url.replace(/\\.js$/,'.module.js');}script.crossOrigin=process.crossOrigin;script.src=url;script.onerror=function(){var error=new Error(\"Error loading script \"+url);error.code='PAGE_LOAD_ERROR';_this5.pageRegisterEvents.emit(route,{error:error});};document.body.appendChild(script);}},{key:\"registerPage\",value:function registerPage(route,regFn){var _this6=this;var register=function register(){try{var mod=regFn();var pageData={page:mod.default||mod,mod:mod};_this6.pageCache[route]=pageData;_this6.pageRegisterEvents.emit(route,pageData);}catch(error){_this6.pageCache[route]={error:error};_this6.pageRegisterEvents.emit(route,{error:error});}};if(true){if(module.hot&&module.hot.status()!=='idle'){console.log(\"Waiting for webpack to become \\\"idle\\\" to initialize the page: \\\"\"+route+\"\\\"\");var check=function check(status){if(status==='idle'){module.hot.removeStatusHandler(check);register();}};module.hot.status(check);return;}}register();}},{key:\"prefetch\",value:function prefetch(route,isDependency){var _this7=this;var cn;if(cn=navigator.connection){if(cn.saveData||/2g/.test(cn.effectiveType))return Promise.resolve();}var url;if(isDependency){url=route;}else{route=normalizeRoute(route);var scriptRoute=(route==='/'?'/index':route)+\".js\";if(process.env.__NEXT_MODERN_BUILD&&hasNoModule){scriptRoute=scriptRoute.replace(/\\.js$/,'.module.js');}url=this.assetPrefix+\"/_next/static/\"+encodeURIComponent(this.buildId)+\"/pages\"+encodeURI(scriptRoute);}return Promise.all(document.querySelector(\"link[rel=\\\"\"+relPrefetch+\"\\\"][href^=\\\"\"+url+\"\\\"], script[data-next-page=\\\"\"+route+\"\\\"]\")?[]:[appendLink(url,relPrefetch,url.match(/\\.css$/)?'style':'script'),process.env.__NEXT_GRANULAR_CHUNKS&&!isDependency&&this.getDependencies(route).then(function(urls){return Promise.all(urls.map(function(url){return _this7.prefetch(url,true);}));})]).then(function(){},function(){});}}]);return PageLoader;}();exports.default=PageLoader;","map":{"version":3,"sources":["../../client/page-loader.js"],"names":["link","document","relPrefetch","hasRel","hasNoModule","route","process","PageLoader","constructor","resolve","window","man","url","assetPrefix","encodeURI","getHrefForSlug","path","buildId","pathname","normalizeRoute","isDynamic","dynamicRegex","dynamicGroups","dynamicMatches","interpolatedRoute","Object","param","value","repeat","Array","encodeURIComponent","s","_dataHref","appendLink","loadPage","loadPageScript","fire","reject","page","mod","cachedPage","error","deps","d","loadRoute","scriptRoute","loadScript","script","register","regFn","pageData","module","console","check","status","cn","navigator","Promise","urls"],"mappings":"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","sourcesContent":["import { parse } from 'url'\nimport mitt from '../next-server/lib/mitt'\nimport { isDynamicRoute } from './../next-server/lib/router/utils/is-dynamic'\nimport { getRouteMatcher } from './../next-server/lib/router/utils/route-matcher'\nimport { getRouteRegex } from './../next-server/lib/router/utils/route-regex'\nimport { delBasePath } from './../next-server/lib/router/router'\n\nfunction hasRel(rel, link) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\n/** @param {string} route */\nfunction normalizeRoute(route) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n  route = route.replace(/\\/index$/, '/')\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(href, rel, as) {\n  return new Promise((res, rej, link) => {\n    link = document.createElement('link')\n    link.crossOrigin = process.crossOrigin\n    link.href = href\n    link.rel = rel\n    if (as) link.as = as\n\n    link.onload = res\n    link.onerror = rej\n\n    document.head.appendChild(link)\n  })\n}\n\nexport default class PageLoader {\n  constructor(buildId, assetPrefix) {\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {}\n    if (process.env.__NEXT_GRANULAR_CHUNKS) {\n      this.promisedBuildManifest = new Promise((resolve) => {\n        if (window.__BUILD_MANIFEST) {\n          resolve(window.__BUILD_MANIFEST)\n        } else {\n          window.__BUILD_MANIFEST_CB = () => {\n            resolve(window.__BUILD_MANIFEST)\n          }\n        }\n      })\n    }\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if (window.__SSG_MANIFEST) {\n        resolve(window.__SSG_MANIFEST)\n      } else {\n        window.__SSG_MANIFEST_CB = () => {\n          resolve(window.__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  getDependencies(route) {\n    return this.promisedBuildManifest.then(\n      (man) =>\n        (man[route] &&\n          man[route].map(\n            (url) => `${this.assetPrefix}/_next/${encodeURI(url)}`\n          )) ||\n        []\n    )\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(href, asPath) {\n    const getHrefForSlug = (/** @type string */ path) => {\n      path = delBasePath(path)\n      return `${this.assetPrefix}/_next/data/${this.buildId}${\n        path === '/' ? '/index' : path\n      }.json`\n    }\n\n    const { pathname: hrefPathname, query } = parse(href, true)\n    const { pathname: asPathname } = parse(asPath)\n\n    const route = normalizeRoute(hrefPathname)\n\n    let isDynamic = isDynamicRoute(route),\n      interpolatedRoute\n    if (isDynamic) {\n      const dynamicRegex = getRouteRegex(route)\n      const dynamicGroups = dynamicRegex.groups\n      const dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        getRouteMatcher(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query\n\n      interpolatedRoute = route\n      if (\n        !Object.keys(dynamicGroups).every((param) => {\n          let value = dynamicMatches[param]\n          const repeat = dynamicGroups[param].repeat\n\n          // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          if (repeat && !Array.isArray(value)) value = [value]\n\n          return (\n            param in dynamicMatches &&\n            // Interpolate group into data URL if present\n            (interpolatedRoute = interpolatedRoute.replace(\n              `[${repeat ? '...' : ''}${param}]`,\n              repeat\n                ? value.map(encodeURIComponent).join('/')\n                : encodeURIComponent(value)\n            ))\n          )\n        })\n      ) {\n        interpolatedRoute = '' // did not satisfy all requirements\n\n        // n.b. We ignore this error because we handle warning for this case in\n        // development in the `<Link>` component directly.\n      }\n    }\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href, asPath) {\n    const { pathname: hrefPathname } = parse(href, true)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest.then(\n      (s, _dataHref) =>\n        // Check if the route requires a data file\n        s.has(route) &&\n        // Try to generate data href, noop when falsy\n        (_dataHref = this.getDataHref(href, asPath)) &&\n        // noop when data has already been prefetched (dedupe)\n        !document.querySelector(\n          `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n        ) &&\n        // Inject the `<link rel=prefetch>` tag for above computed `href`.\n        appendLink(_dataHref, relPrefetch, 'fetch')\n    )\n  }\n\n  loadPage(route) {\n    return this.loadPageScript(route)\n  }\n\n  loadPageScript(route) {\n    route = normalizeRoute(route)\n\n    return new Promise((resolve, reject) => {\n      const fire = ({ error, page, mod }) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if (error) {\n          reject(error)\n        } else {\n          resolve({ page, mod })\n        }\n      }\n\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        const { error, page, mod } = cachedPage\n        error ? reject(error) : resolve({ page, mod })\n        return\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      // If the page is loading via SSR, we need to wait for it\n      // rather downloading it again.\n      if (document.querySelector(`script[data-next-page=\"${route}\"]`)) {\n        return\n      }\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.__NEXT_GRANULAR_CHUNKS) {\n          this.getDependencies(route).then((deps) => {\n            deps.forEach((d) => {\n              if (\n                /\\.js$/.test(d) &&\n                !document.querySelector(`script[src^=\"${d}\"]`)\n              ) {\n                this.loadScript(d, route, false)\n              }\n              if (\n                /\\.css$/.test(d) &&\n                !document.querySelector(`link[rel=stylesheet][href^=\"${d}\"]`)\n              ) {\n                appendLink(d, 'stylesheet').catch(() => {\n                  // FIXME: handle failure\n                  // Right now, this is needed to prevent an unhandled rejection.\n                })\n              }\n            })\n            this.loadRoute(route)\n          })\n        } else {\n          this.loadRoute(route)\n        }\n      }\n    })\n  }\n\n  loadRoute(route) {\n    route = normalizeRoute(route)\n    let scriptRoute = route === '/' ? '/index.js' : `${route}.js`\n\n    const url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n      this.buildId\n    )}/pages${encodeURI(scriptRoute)}`\n    this.loadScript(url, route, true)\n  }\n\n  loadScript(url, route, isPage) {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n      // Only page bundle scripts need to have .module added to url,\n      // dependencies already have it added during build manifest creation\n      if (isPage) url = url.replace(/\\.js$/, '.module.js')\n    }\n    script.crossOrigin = process.crossOrigin\n    script.src = url\n    script.onerror = () => {\n      const error = new Error(`Error loading script ${url}`)\n      error.code = 'PAGE_LOAD_ERROR'\n      this.pageRegisterEvents.emit(route, { error })\n    }\n    document.body.appendChild(script)\n  }\n\n  // This method if called by the route code.\n  registerPage(route, regFn) {\n    const register = () => {\n      try {\n        const mod = regFn()\n        const pageData = { page: mod.default || mod, mod }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if (module.hot && module.hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status) => {\n          if (status === 'idle') {\n            module.hot.removeStatusHandler(check)\n            register()\n          }\n        }\n        module.hot.status(check)\n        return\n      }\n    }\n\n    register()\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route, isDependency) {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = navigator.connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      route = normalizeRoute(route)\n\n      let scriptRoute = `${route === '/' ? '/index' : route}.js`\n      if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n        scriptRoute = scriptRoute.replace(/\\.js$/, '.module.js')\n      }\n\n      url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n        this.buildId\n      )}/pages${encodeURI(scriptRoute)}`\n    }\n\n    return Promise.all(\n      document.querySelector(\n        `link[rel=\"${relPrefetch}\"][href^=\"${url}\"], script[data-next-page=\"${route}\"]`\n      )\n        ? []\n        : [\n            appendLink(\n              url,\n              relPrefetch,\n              url.match(/\\.css$/) ? 'style' : 'script'\n            ),\n            process.env.__NEXT_GRANULAR_CHUNKS &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(urls.map((url) => this.prefetch(url, true)))\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"script"}