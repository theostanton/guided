{"ast":null,"code":"\"use strict\";var _interopRequireDefault2=require(\"@babel/runtime/helpers/interopRequireDefault\");var _regenerator=_interopRequireDefault2(require(\"@babel/runtime/regenerator\"));var _slicedToArray2=_interopRequireDefault2(require(\"@babel/runtime/helpers/slicedToArray\"));var _extends2=_interopRequireDefault2(require(\"@babel/runtime/helpers/extends\"));var _classCallCheck2=_interopRequireDefault2(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault2(require(\"@babel/runtime/helpers/createClass\"));exports.__esModule=true;exports.addBasePath=addBasePath;exports.delBasePath=delBasePath;exports.default=void 0;var _url2=require(\"url\");var _mitt=_interopRequireDefault(require(\"../mitt\"));var _utils=require(\"../utils\");var _isDynamic=require(\"./utils/is-dynamic\");var _routeMatcher=require(\"./utils/route-matcher\");var _routeRegex=require(\"./utils/route-regex\");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var basePath=process.env.__NEXT_ROUTER_BASEPATH||'';function addBasePath(path){return path.indexOf(basePath)!==0?basePath+path:path;}function delBasePath(path){return path.indexOf(basePath)===0?path.substr(basePath.length)||'/':path;}function toRoute(path){return path.replace(/\\/$/,'')||'/';}var prepareRoute=function prepareRoute(path){return toRoute(!path||path==='/'?'/index':path);};function fetchNextData(pathname,query,isServerRender,cb){var attempts=isServerRender?3:1;function getResponse(){return fetch((0,_utils.formatWithValidation)({pathname:addBasePath(\"/_next/data/\"+__NEXT_DATA__.buildId+delBasePath(pathname)+\".json\"),query:query}),{credentials:'same-origin'}).then(function(res){if(!res.ok){if(--attempts>0&&res.status>=500){return getResponse();}throw new Error(\"Failed to load static props\");}return res.json();});}return getResponse().then(function(data){return cb?cb(data):data;}).catch(function(err){if(!isServerRender){;err.code='PAGE_LOAD_ERROR';}throw err;});}var Router=function(){function Router(_pathname,_query,_as2,_ref){var _this=this;var initialProps=_ref.initialProps,pageLoader=_ref.pageLoader,App=_ref.App,wrapApp=_ref.wrapApp,Component=_ref.Component,err=_ref.err,subscription=_ref.subscription,isFallback=_ref.isFallback;(0,_classCallCheck2.default)(this,Router);this.route=void 0;this.pathname=void 0;this.query=void 0;this.asPath=void 0;this.basePath=void 0;this.components=void 0;this.sdc={};this.sub=void 0;this.clc=void 0;this.pageLoader=void 0;this._bps=void 0;this.events=void 0;this._wrapApp=void 0;this.isSsr=void 0;this.isFallback=void 0;this.onPopState=function(e){if(!e.state){var pathname=_this.pathname,query=_this.query;_this.changeState('replaceState',(0,_utils.formatWithValidation)({pathname:pathname,query:query}),(0,_utils.getURL)());return;}if(e.state&&_this.isSsr&&e.state.as===_this.asPath&&(0,_url2.parse)(e.state.url).pathname===_this.pathname){return;}if(_this._bps&&!_this._bps(e.state)){return;}var _e$state=e.state,url=_e$state.url,as=_e$state.as,options=_e$state.options;if(true){if(typeof url==='undefined'||typeof as==='undefined'){console.warn('`popstate` event triggered but `event.state` did not have `url` or `as` https://err.sh/vercel/next.js/popstate-state-empty');}}_this.replace(url,as,options);};this._getStaticData=function(asPath){var pathname=prepareRoute((0,_url2.parse)(asPath).pathname);return false&&_this.sdc[pathname]?Promise.resolve(_this.sdc[pathname]):fetchNextData(pathname,null,_this.isSsr,function(data){return _this.sdc[pathname]=data;});};this._getServerData=function(asPath){var _ref2=(0,_url2.parse)(asPath,true),pathname=_ref2.pathname,query=_ref2.query;pathname=prepareRoute(pathname);return fetchNextData(pathname,query,_this.isSsr);};this.route=toRoute(_pathname);this.components={};if(_pathname!=='/_error'){this.components[this.route]={Component:Component,props:initialProps,err:err,__N_SSG:initialProps&&initialProps.__N_SSG,__N_SSP:initialProps&&initialProps.__N_SSP};}this.components['/_app']={Component:App};this.events=Router.events;this.pageLoader=pageLoader;this.pathname=_pathname;this.query=_query;this.asPath=(0,_isDynamic.isDynamicRoute)(_pathname)&&__NEXT_DATA__.autoExport?_pathname:_as2;this.basePath=basePath;this.sub=subscription;this.clc=null;this._wrapApp=wrapApp;this.isSsr=true;this.isFallback=isFallback;if(true){if(_as2.substr(0,2)!=='//'){this.changeState('replaceState',(0,_utils.formatWithValidation)({pathname:_pathname,query:_query}),_as2);}window.addEventListener('popstate',this.onPopState);}}(0,_createClass2.default)(Router,[{key:\"update\",value:function update(route,mod){var Component=mod.default||mod;var data=this.components[route];if(!data){throw new Error(\"Cannot update unavailable route: \"+route);}var newData=(0,_extends2.default)({},data,{Component:Component,__N_SSG:mod.__N_SSG,__N_SSP:mod.__N_SSP});this.components[route]=newData;if(route==='/_app'){this.notify(this.components[this.route]);return;}if(route===this.route){this.notify(newData);}}},{key:\"reload\",value:function reload(){window.location.reload();}},{key:\"back\",value:function back(){window.history.back();}},{key:\"push\",value:function push(url){var as=arguments.length>1&&arguments[1]!==undefined?arguments[1]:url;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this.change('pushState',url,as,options);}},{key:\"replace\",value:function replace(url){var as=arguments.length>1&&arguments[1]!==undefined?arguments[1]:url;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this.change('replaceState',url,as,options);}},{key:\"change\",value:function change(method,_url,_as,options){var _this2=this;return new Promise(function(resolve,reject){if(!options._h){_this2.isSsr=false;}if(_utils.ST){performance.mark('routeChange');}var url=typeof _url==='object'?(0,_utils.formatWithValidation)(_url):_url;var as=typeof _as==='object'?(0,_utils.formatWithValidation)(_as):_as;url=addBasePath(url);as=addBasePath(as);if(process.env.__NEXT_EXPORT_TRAILING_SLASH){var rewriteUrlForNextExport=require('./rewrite-url-for-export').rewriteUrlForNextExport;if(__NEXT_DATA__.nextExport){as=rewriteUrlForNextExport(as);}}_this2.abortComponentLoad(as);if(!options._h&&_this2.onlyAHashChange(as)){_this2.asPath=as;Router.events.emit('hashChangeStart',as);_this2.changeState(method,url,as,options);_this2.scrollToHash(as);Router.events.emit('hashChangeComplete',as);return resolve(true);}var _ref3=(0,_url2.parse)(url,true),pathname=_ref3.pathname,query=_ref3.query,protocol=_ref3.protocol;if(!pathname||protocol){if(true){throw new Error(\"Invalid href passed to router: \"+url+\" https://err.sh/vercel/next.js/invalid-href-passed\");}return resolve(false);}if(!_this2.urlIsNew(as)){method='replaceState';}var route=toRoute(pathname);var _options$shallow=options.shallow,shallow=_options$shallow===void 0?false:_options$shallow;if((0,_isDynamic.isDynamicRoute)(route)){var _ref4=(0,_url2.parse)(as),asPathname=_ref4.pathname;var routeRegex=(0,_routeRegex.getRouteRegex)(route);var routeMatch=(0,_routeMatcher.getRouteMatcher)(routeRegex)(asPathname);if(!routeMatch){var missingParams=Object.keys(routeRegex.groups).filter(function(param){return!query[param];});if(missingParams.length>0){if(true){console.warn(\"Mismatching `as` and `href` failed to manually provide \"+(\"the params: \"+missingParams.join(', ')+\" in the `href`'s `query`\"));}return reject(new Error(\"The provided `as` value (\"+asPathname+\") is incompatible with the `href` value (\"+route+\"). \"+\"Read more: https://err.sh/vercel/next.js/incompatible-href-as\"));}}else{(0,_extends2.default)(query,routeMatch);}}Router.events.emit('routeChangeStart',as);_this2.getRouteInfo(route,pathname,query,as,shallow).then(function(routeInfo){var error=routeInfo.error;if(error&&error.cancelled){return resolve(false);}Router.events.emit('beforeHistoryChange',as);_this2.changeState(method,url,as,options);if(true){var appComp=_this2.components['/_app'].Component;window.next.isPrerendered=appComp.getInitialProps===appComp.origGetInitialProps&&!routeInfo.Component.getInitialProps;}_this2.set(route,pathname,query,as,routeInfo).then(function(){if(error){Router.events.emit('routeChangeError',error,as);throw error;}Router.events.emit('routeChangeComplete',as);return resolve(true);});},reject);});}},{key:\"changeState\",value:function changeState(method,url,as){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(true){if(typeof window.history==='undefined'){console.error(\"Warning: window.history is not available.\");return;}if(typeof window.history[method]==='undefined'){console.error(\"Warning: window.history.\"+method+\" is not available\");return;}}if(method!=='pushState'||(0,_utils.getURL)()!==as){window.history[method]({url:url,as:as,options:options},'',as);}}},{key:\"getRouteInfo\",value:function getRouteInfo(route,pathname,query,as){var _this3=this;var shallow=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var cachedRouteInfo=this.components[route];if(shallow&&cachedRouteInfo&&this.route===route){return Promise.resolve(cachedRouteInfo);}var handleError=function handleError(err,loadErrorFail){return new Promise(function(resolve){if(err.code==='PAGE_LOAD_ERROR'||loadErrorFail){window.location.href=as;err.cancelled=true;return resolve({error:err});}if(err.cancelled){return resolve({error:err});}resolve(_this3.fetchComponent('/_error').then(function(res){var Component=res.page;var routeInfo={Component:Component,err:err};return new Promise(function(resolve){_this3.getInitialProps(Component,{err:err,pathname:pathname,query:query}).then(function(props){routeInfo.props=props;routeInfo.error=err;resolve(routeInfo);},function(gipErr){console.error('Error in error page `getInitialProps`: ',gipErr);routeInfo.error=err;routeInfo.props={};resolve(routeInfo);});});}).catch(function(err){return handleError(err,true);}));});};return new Promise(function(resolve,reject){if(cachedRouteInfo){return resolve(cachedRouteInfo);}_this3.fetchComponent(route).then(function(res){return resolve({Component:res.page,__N_SSG:res.mod.__N_SSG,__N_SSP:res.mod.__N_SSP});},reject);}).then(function(routeInfo){var Component=routeInfo.Component,__N_SSG=routeInfo.__N_SSG,__N_SSP=routeInfo.__N_SSP;if(true){var _require=require('react-is'),isValidElementType=_require.isValidElementType;if(!isValidElementType(Component)){throw new Error(\"The default export is not a React Component in page: \\\"\"+pathname+\"\\\"\");}}return _this3._getData(function(){return __N_SSG?_this3._getStaticData(as):__N_SSP?_this3._getServerData(as):_this3.getInitialProps(Component,{pathname:pathname,query:query,asPath:as});}).then(function(props){routeInfo.props=props;_this3.components[route]=routeInfo;return routeInfo;});}).catch(handleError);}},{key:\"set\",value:function set(route,pathname,query,as,data){this.isFallback=false;this.route=route;this.pathname=pathname;this.query=query;this.asPath=as;return this.notify(data);}},{key:\"beforePopState\",value:function beforePopState(cb){this._bps=cb;}},{key:\"onlyAHashChange\",value:function onlyAHashChange(as){if(!this.asPath)return false;var _this$asPath$split=this.asPath.split('#'),_this$asPath$split2=(0,_slicedToArray2.default)(_this$asPath$split,2),oldUrlNoHash=_this$asPath$split2[0],oldHash=_this$asPath$split2[1];var _as$split=as.split('#'),_as$split2=(0,_slicedToArray2.default)(_as$split,2),newUrlNoHash=_as$split2[0],newHash=_as$split2[1];if(newHash&&oldUrlNoHash===newUrlNoHash&&oldHash===newHash){return true;}if(oldUrlNoHash!==newUrlNoHash){return false;}return oldHash!==newHash;}},{key:\"scrollToHash\",value:function scrollToHash(as){var _as$split3=as.split('#'),_as$split4=(0,_slicedToArray2.default)(_as$split3,2),hash=_as$split4[1];if(hash===''){window.scrollTo(0,0);return;}var idEl=document.getElementById(hash);if(idEl){idEl.scrollIntoView();return;}var nameEl=document.getElementsByName(hash)[0];if(nameEl){nameEl.scrollIntoView();}}},{key:\"urlIsNew\",value:function urlIsNew(asPath){return this.asPath!==asPath;}},{key:\"prefetch\",value:function prefetch(url){var _this4=this;var asPath=arguments.length>1&&arguments[1]!==undefined?arguments[1]:url;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise(function(resolve,reject){var _ref5=(0,_url2.parse)(url),pathname=_ref5.pathname,protocol=_ref5.protocol;if(!pathname||protocol){if(true){throw new Error(\"Invalid href passed to router: \"+url+\" https://err.sh/vercel/next.js/invalid-href-passed\");}return;}if(true){return;}var route=delBasePath(toRoute(pathname));Promise.all([_this4.pageLoader.prefetchData(url,delBasePath(asPath)),_this4.pageLoader[options.priority?'loadPage':'prefetch'](route)]).then(function(){return resolve();},reject);});}},{key:\"fetchComponent\",value:function fetchComponent(route){var cancelled,cancel,componentResult,error;return _regenerator.default.async(function fetchComponent$(_context){while(1){switch(_context.prev=_context.next){case 0:cancelled=false;cancel=this.clc=function(){cancelled=true;};route=delBasePath(route);_context.next=5;return _regenerator.default.awrap(this.pageLoader.loadPage(route));case 5:componentResult=_context.sent;if(!cancelled){_context.next=10;break;}error=new Error(\"Abort fetching component for route: \\\"\"+route+\"\\\"\");error.cancelled=true;throw error;case 10:if(cancel===this.clc){this.clc=null;}return _context.abrupt(\"return\",componentResult);case 12:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"_getData\",value:function _getData(fn){var _this5=this;var cancelled=false;var cancel=function cancel(){cancelled=true;};this.clc=cancel;return fn().then(function(data){if(cancel===_this5.clc){_this5.clc=null;}if(cancelled){var err=new Error('Loading initial props cancelled');err.cancelled=true;throw err;}return data;});}},{key:\"getInitialProps\",value:function getInitialProps(Component,ctx){var App=this.components['/_app'].Component;var AppTree=this._wrapApp(App);ctx.AppTree=AppTree;return(0,_utils.loadGetInitialProps)(App,{AppTree:AppTree,Component:Component,router:this,ctx:ctx});}},{key:\"abortComponentLoad\",value:function abortComponentLoad(as){if(this.clc){var e=new Error('Route Cancelled');e.cancelled=true;Router.events.emit('routeChangeError',e,as);this.clc();this.clc=null;}}},{key:\"notify\",value:function notify(data){return this.sub(data,this.components['/_app'].Component);}}],[{key:\"_rewriteUrlForNextExport\",value:function _rewriteUrlForNextExport(url){if(process.env.__NEXT_EXPORT_TRAILING_SLASH){var rewriteUrlForNextExport=require('./rewrite-url-for-export').rewriteUrlForNextExport;return rewriteUrlForNextExport(url);}else{return url;}}}]);return Router;}();exports.default=Router;Router.events=(0,_mitt.default)();","map":{"version":3,"sources":["../../../../next-server/lib/router/router.ts"],"names":["basePath","process","path","prepareRoute","toRoute","attempts","isServerRender","pathname","addBasePath","__NEXT_DATA__","buildId","delBasePath","query","credentials","res","getResponse","data","cb","err","Router","route","asPath","components","sdc","sub","clc","pageLoader","_bps","events","_wrapApp","isSsr","isFallback","constructor","Component","props","__N_SSG","initialProps","__N_SSP","as","window","rewriteUrlForNextExport","require","e","console","update","mod","newData","Object","reload","options","change","ST","performance","url","resolve","method","shallow","routeRegex","routeMatch","missingParams","param","reject","asPathname","routeInfo","error","appComp","changeState","getRouteInfo","cachedRouteInfo","Promise","handleError","page","gipErr","isValidElementType","set","onlyAHashChange","newHash","oldUrlNoHash","oldHash","scrollToHash","hash","idEl","document","nameEl","urlIsNew","cancelled","cancel","componentResult","fn","fetchNextData","getInitialProps","AppTree","ctx","router","abortComponentLoad","notify"],"mappings":"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","sourcesContent":["/* global __NEXT_DATA__ */\n// tslint:disable:no-console\nimport { ParsedUrlQuery } from 'querystring'\nimport { ComponentType } from 'react'\nimport { parse, UrlObject } from 'url'\nimport mitt, { MittEmitter } from '../mitt'\nimport {\n  AppContextType,\n  formatWithValidation,\n  getURL,\n  loadGetInitialProps,\n  NextPageContext,\n  ST,\n} from '../utils'\nimport { isDynamicRoute } from './utils/is-dynamic'\nimport { getRouteMatcher } from './utils/route-matcher'\nimport { getRouteRegex } from './utils/route-regex'\n\nconst basePath = (process.env.__NEXT_ROUTER_BASEPATH as string) || ''\n\nexport function addBasePath(path: string): string {\n  return path.indexOf(basePath) !== 0 ? basePath + path : path\n}\n\nexport function delBasePath(path: string): string {\n  return path.indexOf(basePath) === 0\n    ? path.substr(basePath.length) || '/'\n    : path\n}\n\nfunction toRoute(path: string): string {\n  return path.replace(/\\/$/, '') || '/'\n}\n\nconst prepareRoute = (path: string) =>\n  toRoute(!path || path === '/' ? '/index' : path)\n\ntype Url = UrlObject | string\n\ntype ComponentRes = { page: ComponentType; mod: any }\n\nexport type BaseRouter = {\n  route: string\n  pathname: string\n  query: ParsedUrlQuery\n  asPath: string\n  basePath: string\n}\n\nexport type NextRouter = BaseRouter &\n  Pick<\n    Router,\n    | 'push'\n    | 'replace'\n    | 'reload'\n    | 'back'\n    | 'prefetch'\n    | 'beforePopState'\n    | 'events'\n    | 'isFallback'\n  >\n\nexport type PrefetchOptions = {\n  priority?: boolean\n}\n\ntype RouteInfo = {\n  Component: ComponentType\n  __N_SSG?: boolean\n  __N_SSP?: boolean\n  props?: any\n  err?: Error\n  error?: any\n}\n\ntype Subscription = (data: RouteInfo, App?: ComponentType) => Promise<void>\n\ntype BeforePopStateCallback = (state: any) => boolean\n\ntype ComponentLoadCancel = (() => void) | null\n\ntype HistoryMethod = 'replaceState' | 'pushState'\n\nfunction fetchNextData(\n  pathname: string,\n  query: ParsedUrlQuery | null,\n  isServerRender: boolean,\n  cb?: (...args: any) => any\n) {\n  let attempts = isServerRender ? 3 : 1\n  function getResponse(): Promise<any> {\n    return fetch(\n      formatWithValidation({\n        pathname: addBasePath(\n          // @ts-ignore __NEXT_DATA__\n          `/_next/data/${__NEXT_DATA__.buildId}${delBasePath(pathname)}.json`\n        ),\n        query,\n      }),\n      {\n        // Cookies are required to be present for Next.js' SSG \"Preview Mode\".\n        // Cookies may also be required for `getServerSideProps`.\n        //\n        // > `fetch` wonâ€™t send cookies, unless you set the credentials init\n        // > option.\n        // https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\n        //\n        // > For maximum browser compatibility when it comes to sending &\n        // > receiving cookies, always supply the `credentials: 'same-origin'`\n        // > option instead of relying on the default.\n        // https://github.com/github/fetch#caveats\n        credentials: 'same-origin',\n      }\n    ).then((res) => {\n      if (!res.ok) {\n        if (--attempts > 0 && res.status >= 500) {\n          return getResponse()\n        }\n        throw new Error(`Failed to load static props`)\n      }\n      return res.json()\n    })\n  }\n\n  return getResponse()\n    .then((data) => {\n      return cb ? cb(data) : data\n    })\n    .catch((err: Error) => {\n      // We should only trigger a server-side transition if this was caused\n      // on a client-side transition. Otherwise, we'd get into an infinite\n      // loop.\n      if (!isServerRender) {\n        ;(err as any).code = 'PAGE_LOAD_ERROR'\n      }\n      throw err\n    })\n}\n\nexport default class Router implements BaseRouter {\n  route: string\n  pathname: string\n  query: ParsedUrlQuery\n  asPath: string\n  basePath: string\n\n  /**\n   * Map of all components loaded in `Router`\n   */\n  components: { [pathname: string]: RouteInfo }\n  // Static Data Cache\n  sdc: { [asPath: string]: object } = {}\n  sub: Subscription\n  clc: ComponentLoadCancel\n  pageLoader: any\n  _bps: BeforePopStateCallback | undefined\n  events: MittEmitter\n  _wrapApp: (App: ComponentType) => any\n  isSsr: boolean\n  isFallback: boolean\n\n  static events: MittEmitter = mitt()\n\n  constructor(\n    pathname: string,\n    query: ParsedUrlQuery,\n    as: string,\n    {\n      initialProps,\n      pageLoader,\n      App,\n      wrapApp,\n      Component,\n      err,\n      subscription,\n      isFallback,\n    }: {\n      subscription: Subscription\n      initialProps: any\n      pageLoader: any\n      Component: ComponentType\n      App: ComponentType\n      wrapApp: (App: ComponentType) => any\n      err?: Error\n      isFallback: boolean\n    }\n  ) {\n    // represents the current component key\n    this.route = toRoute(pathname)\n\n    // set up the component cache (by route keys)\n    this.components = {}\n    // We should not keep the cache, if there's an error\n    // Otherwise, this cause issues when when going back and\n    // come again to the errored page.\n    if (pathname !== '/_error') {\n      this.components[this.route] = {\n        Component,\n        props: initialProps,\n        err,\n        __N_SSG: initialProps && initialProps.__N_SSG,\n        __N_SSP: initialProps && initialProps.__N_SSP,\n      }\n    }\n\n    this.components['/_app'] = { Component: App }\n\n    // Backwards compat for Router.router.events\n    // TODO: Should be remove the following major version as it was never documented\n    this.events = Router.events\n\n    this.pageLoader = pageLoader\n    this.pathname = pathname\n    this.query = query\n    // if auto prerendered and dynamic route wait to update asPath\n    // until after mount to prevent hydration mismatch\n    this.asPath =\n      // @ts-ignore this is temporarily global (attached to window)\n      isDynamicRoute(pathname) && __NEXT_DATA__.autoExport ? pathname : as\n    this.basePath = basePath\n    this.sub = subscription\n    this.clc = null\n    this._wrapApp = wrapApp\n    // make sure to ignore extra popState in safari on navigating\n    // back from external site\n    this.isSsr = true\n\n    this.isFallback = isFallback\n\n    if (typeof window !== 'undefined') {\n      // make sure \"as\" doesn't start with double slashes or else it can\n      // throw an error as it's considered invalid\n      if (as.substr(0, 2) !== '//') {\n        // in order for `e.state` to work on the `onpopstate` event\n        // we have to register the initial route upon initialization\n        this.changeState(\n          'replaceState',\n          formatWithValidation({ pathname, query }),\n          as\n        )\n      }\n\n      window.addEventListener('popstate', this.onPopState)\n    }\n  }\n\n  // @deprecated backwards compatibility even though it's a private method.\n  static _rewriteUrlForNextExport(url: string): string {\n    if (process.env.__NEXT_EXPORT_TRAILING_SLASH) {\n      const rewriteUrlForNextExport = require('./rewrite-url-for-export')\n        .rewriteUrlForNextExport\n      return rewriteUrlForNextExport(url)\n    } else {\n      return url\n    }\n  }\n\n  onPopState = (e: PopStateEvent): void => {\n    if (!e.state) {\n      // We get state as undefined for two reasons.\n      //  1. With older safari (< 8) and older chrome (< 34)\n      //  2. When the URL changed with #\n      //\n      // In the both cases, we don't need to proceed and change the route.\n      // (as it's already changed)\n      // But we can simply replace the state with the new changes.\n      // Actually, for (1) we don't need to nothing. But it's hard to detect that event.\n      // So, doing the following for (1) does no harm.\n      const { pathname, query } = this\n      this.changeState(\n        'replaceState',\n        formatWithValidation({ pathname, query }),\n        getURL()\n      )\n      return\n    }\n\n    // Make sure we don't re-render on initial load,\n    // can be caused by navigating back from an external site\n    if (\n      e.state &&\n      this.isSsr &&\n      e.state.as === this.asPath &&\n      parse(e.state.url).pathname === this.pathname\n    ) {\n      return\n    }\n\n    // If the downstream application returns falsy, return.\n    // They will then be responsible for handling the event.\n    if (this._bps && !this._bps(e.state)) {\n      return\n    }\n\n    const { url, as, options } = e.state\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof url === 'undefined' || typeof as === 'undefined') {\n        console.warn(\n          '`popstate` event triggered but `event.state` did not have `url` or `as` https://err.sh/vercel/next.js/popstate-state-empty'\n        )\n      }\n    }\n    this.replace(url, as, options)\n  }\n\n  update(route: string, mod: any) {\n    const Component: ComponentType = mod.default || mod\n    const data = this.components[route]\n    if (!data) {\n      throw new Error(`Cannot update unavailable route: ${route}`)\n    }\n\n    const newData = Object.assign({}, data, {\n      Component,\n      __N_SSG: mod.__N_SSG,\n      __N_SSP: mod.__N_SSP,\n    })\n    this.components[route] = newData\n\n    // pages/_app.js updated\n    if (route === '/_app') {\n      this.notify(this.components[this.route])\n      return\n    }\n\n    if (route === this.route) {\n      this.notify(newData)\n    }\n  }\n\n  reload(): void {\n    window.location.reload()\n  }\n\n  /**\n   * Go back in history\n   */\n  back() {\n    window.history.back()\n  }\n\n  /**\n   * Performs a `pushState` with arguments\n   * @param url of the route\n   * @param as masks `url` for the browser\n   * @param options object you can define `shallow` and other options\n   */\n  push(url: Url, as: Url = url, options = {}) {\n    return this.change('pushState', url, as, options)\n  }\n\n  /**\n   * Performs a `replaceState` with arguments\n   * @param url of the route\n   * @param as masks `url` for the browser\n   * @param options object you can define `shallow` and other options\n   */\n  replace(url: Url, as: Url = url, options = {}) {\n    return this.change('replaceState', url, as, options)\n  }\n\n  change(\n    method: HistoryMethod,\n    _url: Url,\n    _as: Url,\n    options: any\n  ): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      if (!options._h) {\n        this.isSsr = false\n      }\n      // marking route changes as a navigation start entry\n      if (ST) {\n        performance.mark('routeChange')\n      }\n\n      // If url and as provided as an object representation,\n      // we'll format them into the string version here.\n      let url = typeof _url === 'object' ? formatWithValidation(_url) : _url\n      let as = typeof _as === 'object' ? formatWithValidation(_as) : _as\n\n      url = addBasePath(url)\n      as = addBasePath(as)\n\n      // Add the ending slash to the paths. So, we can serve the\n      // \"<page>/index.html\" directly for the SSR page.\n      if (process.env.__NEXT_EXPORT_TRAILING_SLASH) {\n        const rewriteUrlForNextExport = require('./rewrite-url-for-export')\n          .rewriteUrlForNextExport\n        // @ts-ignore this is temporarily global (attached to window)\n        if (__NEXT_DATA__.nextExport) {\n          as = rewriteUrlForNextExport(as)\n        }\n      }\n\n      this.abortComponentLoad(as)\n\n      // If the url change is only related to a hash change\n      // We should not proceed. We should only change the state.\n\n      // WARNING: `_h` is an internal option for handing Next.js client-side\n      // hydration. Your app should _never_ use this property. It may change at\n      // any time without notice.\n      if (!options._h && this.onlyAHashChange(as)) {\n        this.asPath = as\n        Router.events.emit('hashChangeStart', as)\n        this.changeState(method, url, as, options)\n        this.scrollToHash(as)\n        Router.events.emit('hashChangeComplete', as)\n        return resolve(true)\n      }\n\n      const { pathname, query, protocol } = parse(url, true)\n\n      if (!pathname || protocol) {\n        if (process.env.NODE_ENV !== 'production') {\n          throw new Error(\n            `Invalid href passed to router: ${url} https://err.sh/vercel/next.js/invalid-href-passed`\n          )\n        }\n        return resolve(false)\n      }\n\n      // If asked to change the current URL we should reload the current page\n      // (not location.reload() but reload getInitialProps and other Next.js stuffs)\n      // We also need to set the method = replaceState always\n      // as this should not go into the history (That's how browsers work)\n      // We should compare the new asPath to the current asPath, not the url\n      if (!this.urlIsNew(as)) {\n        method = 'replaceState'\n      }\n\n      const route = toRoute(pathname)\n      const { shallow = false } = options\n\n      if (isDynamicRoute(route)) {\n        const { pathname: asPathname } = parse(as)\n        const routeRegex = getRouteRegex(route)\n        const routeMatch = getRouteMatcher(routeRegex)(asPathname)\n        if (!routeMatch) {\n          const missingParams = Object.keys(routeRegex.groups).filter(\n            (param) => !query[param]\n          )\n\n          if (missingParams.length > 0) {\n            if (process.env.NODE_ENV !== 'production') {\n              console.warn(\n                `Mismatching \\`as\\` and \\`href\\` failed to manually provide ` +\n                  `the params: ${missingParams.join(\n                    ', '\n                  )} in the \\`href\\`'s \\`query\\``\n              )\n            }\n\n            return reject(\n              new Error(\n                `The provided \\`as\\` value (${asPathname}) is incompatible with the \\`href\\` value (${route}). ` +\n                  `Read more: https://err.sh/vercel/next.js/incompatible-href-as`\n              )\n            )\n          }\n        } else {\n          // Merge params into `query`, overwriting any specified in search\n          Object.assign(query, routeMatch)\n        }\n      }\n\n      Router.events.emit('routeChangeStart', as)\n\n      // If shallow is true and the route exists in the router cache we reuse the previous result\n      this.getRouteInfo(route, pathname, query, as, shallow).then(\n        (routeInfo) => {\n          const { error } = routeInfo\n\n          if (error && error.cancelled) {\n            return resolve(false)\n          }\n\n          Router.events.emit('beforeHistoryChange', as)\n          this.changeState(method, url, as, options)\n\n          if (process.env.NODE_ENV !== 'production') {\n            const appComp: any = this.components['/_app'].Component\n            ;(window as any).next.isPrerendered =\n              appComp.getInitialProps === appComp.origGetInitialProps &&\n              !(routeInfo.Component as any).getInitialProps\n          }\n\n          this.set(route, pathname, query, as, routeInfo).then(() => {\n            if (error) {\n              Router.events.emit('routeChangeError', error, as)\n              throw error\n            }\n\n            Router.events.emit('routeChangeComplete', as)\n            return resolve(true)\n          })\n        },\n        reject\n      )\n    })\n  }\n\n  changeState(\n    method: HistoryMethod,\n    url: string,\n    as: string,\n    options = {}\n  ): void {\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof window.history === 'undefined') {\n        console.error(`Warning: window.history is not available.`)\n        return\n      }\n\n      if (typeof window.history[method] === 'undefined') {\n        console.error(`Warning: window.history.${method} is not available`)\n        return\n      }\n    }\n\n    if (method !== 'pushState' || getURL() !== as) {\n      window.history[method](\n        {\n          url,\n          as,\n          options,\n        },\n        // Most browsers currently ignores this parameter, although they may use it in the future.\n        // Passing the empty string here should be safe against future changes to the method.\n        // https://developer.mozilla.org/en-US/docs/Web/API/History/replaceState\n        '',\n        as\n      )\n    }\n  }\n\n  getRouteInfo(\n    route: string,\n    pathname: string,\n    query: any,\n    as: string,\n    shallow: boolean = false\n  ): Promise<RouteInfo> {\n    const cachedRouteInfo = this.components[route]\n\n    // If there is a shallow route transition possible\n    // If the route is already rendered on the screen.\n    if (shallow && cachedRouteInfo && this.route === route) {\n      return Promise.resolve(cachedRouteInfo)\n    }\n\n    const handleError = (\n      err: Error & { code: any; cancelled: boolean },\n      loadErrorFail?: boolean\n    ) => {\n      return new Promise((resolve) => {\n        if (err.code === 'PAGE_LOAD_ERROR' || loadErrorFail) {\n          // If we can't load the page it could be one of following reasons\n          //  1. Page doesn't exists\n          //  2. Page does exist in a different zone\n          //  3. Internal error while loading the page\n\n          // So, doing a hard reload is the proper way to deal with this.\n          window.location.href = as\n\n          // Changing the URL doesn't block executing the current code path.\n          // So, we need to mark it as a cancelled error and stop the routing logic.\n          err.cancelled = true\n          // @ts-ignore TODO: fix the control flow here\n          return resolve({ error: err })\n        }\n\n        if (err.cancelled) {\n          // @ts-ignore TODO: fix the control flow here\n          return resolve({ error: err })\n        }\n\n        resolve(\n          this.fetchComponent('/_error')\n            .then((res) => {\n              const { page: Component } = res\n              const routeInfo: RouteInfo = { Component, err }\n              return new Promise((resolve) => {\n                this.getInitialProps(Component, {\n                  err,\n                  pathname,\n                  query,\n                } as any).then(\n                  (props) => {\n                    routeInfo.props = props\n                    routeInfo.error = err\n                    resolve(routeInfo)\n                  },\n                  (gipErr) => {\n                    console.error(\n                      'Error in error page `getInitialProps`: ',\n                      gipErr\n                    )\n                    routeInfo.error = err\n                    routeInfo.props = {}\n                    resolve(routeInfo)\n                  }\n                )\n              }) as Promise<RouteInfo>\n            })\n            .catch((err) => handleError(err, true))\n        )\n      }) as Promise<RouteInfo>\n    }\n\n    return (new Promise((resolve, reject) => {\n      if (cachedRouteInfo) {\n        return resolve(cachedRouteInfo)\n      }\n\n      this.fetchComponent(route).then(\n        (res) =>\n          resolve({\n            Component: res.page,\n            __N_SSG: res.mod.__N_SSG,\n            __N_SSP: res.mod.__N_SSP,\n          }),\n        reject\n      )\n    }) as Promise<RouteInfo>)\n      .then((routeInfo: RouteInfo) => {\n        const { Component, __N_SSG, __N_SSP } = routeInfo\n\n        if (process.env.NODE_ENV !== 'production') {\n          const { isValidElementType } = require('react-is')\n          if (!isValidElementType(Component)) {\n            throw new Error(\n              `The default export is not a React Component in page: \"${pathname}\"`\n            )\n          }\n        }\n\n        return this._getData<RouteInfo>(() =>\n          __N_SSG\n            ? this._getStaticData(as)\n            : __N_SSP\n            ? this._getServerData(as)\n            : this.getInitialProps(\n                Component,\n                // we provide AppTree later so this needs to be `any`\n                {\n                  pathname,\n                  query,\n                  asPath: as,\n                } as any\n              )\n        ).then((props) => {\n          routeInfo.props = props\n          this.components[route] = routeInfo\n          return routeInfo\n        })\n      })\n      .catch(handleError)\n  }\n\n  set(\n    route: string,\n    pathname: string,\n    query: any,\n    as: string,\n    data: RouteInfo\n  ): Promise<void> {\n    this.isFallback = false\n\n    this.route = route\n    this.pathname = pathname\n    this.query = query\n    this.asPath = as\n    return this.notify(data)\n  }\n\n  /**\n   * Callback to execute before replacing router state\n   * @param cb callback to be executed\n   */\n  beforePopState(cb: BeforePopStateCallback) {\n    this._bps = cb\n  }\n\n  onlyAHashChange(as: string): boolean {\n    if (!this.asPath) return false\n    const [oldUrlNoHash, oldHash] = this.asPath.split('#')\n    const [newUrlNoHash, newHash] = as.split('#')\n\n    // Makes sure we scroll to the provided hash if the url/hash are the same\n    if (newHash && oldUrlNoHash === newUrlNoHash && oldHash === newHash) {\n      return true\n    }\n\n    // If the urls are change, there's more than a hash change\n    if (oldUrlNoHash !== newUrlNoHash) {\n      return false\n    }\n\n    // If the hash has changed, then it's a hash only change.\n    // This check is necessary to handle both the enter and\n    // leave hash === '' cases. The identity case falls through\n    // and is treated as a next reload.\n    return oldHash !== newHash\n  }\n\n  scrollToHash(as: string): void {\n    const [, hash] = as.split('#')\n    // Scroll to top if the hash is just `#` with no value\n    if (hash === '') {\n      window.scrollTo(0, 0)\n      return\n    }\n\n    // First we check if the element by id is found\n    const idEl = document.getElementById(hash)\n    if (idEl) {\n      idEl.scrollIntoView()\n      return\n    }\n    // If there's no element with the id, we check the `name` property\n    // To mirror browsers\n    const nameEl = document.getElementsByName(hash)[0]\n    if (nameEl) {\n      nameEl.scrollIntoView()\n    }\n  }\n\n  urlIsNew(asPath: string): boolean {\n    return this.asPath !== asPath\n  }\n\n  /**\n   * Prefetch page code, you may wait for the data during page rendering.\n   * This feature only works in production!\n   * @param url the href of prefetched page\n   * @param asPath the as path of the prefetched page\n   */\n  prefetch(\n    url: string,\n    asPath: string = url,\n    options: PrefetchOptions = {}\n  ): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const { pathname, protocol } = parse(url)\n\n      if (!pathname || protocol) {\n        if (process.env.NODE_ENV !== 'production') {\n          throw new Error(\n            `Invalid href passed to router: ${url} https://err.sh/vercel/next.js/invalid-href-passed`\n          )\n        }\n        return\n      }\n\n      // Prefetch is not supported in development mode because it would trigger on-demand-entries\n      if (process.env.NODE_ENV !== 'production') {\n        return\n      }\n      const route = delBasePath(toRoute(pathname))\n      Promise.all([\n        this.pageLoader.prefetchData(url, delBasePath(asPath)),\n        this.pageLoader[options.priority ? 'loadPage' : 'prefetch'](route),\n      ]).then(() => resolve(), reject)\n    })\n  }\n\n  async fetchComponent(route: string): Promise<ComponentRes> {\n    let cancelled = false\n    const cancel = (this.clc = () => {\n      cancelled = true\n    })\n    route = delBasePath(route)\n\n    const componentResult = await this.pageLoader.loadPage(route)\n\n    if (cancelled) {\n      const error: any = new Error(\n        `Abort fetching component for route: \"${route}\"`\n      )\n      error.cancelled = true\n      throw error\n    }\n\n    if (cancel === this.clc) {\n      this.clc = null\n    }\n\n    return componentResult\n  }\n\n  _getData<T>(fn: () => Promise<T>): Promise<T> {\n    let cancelled = false\n    const cancel = () => {\n      cancelled = true\n    }\n    this.clc = cancel\n    return fn().then((data) => {\n      if (cancel === this.clc) {\n        this.clc = null\n      }\n\n      if (cancelled) {\n        const err: any = new Error('Loading initial props cancelled')\n        err.cancelled = true\n        throw err\n      }\n\n      return data\n    })\n  }\n\n  _getStaticData = (asPath: string): Promise<object> => {\n    const pathname = prepareRoute(parse(asPath).pathname!)\n\n    return process.env.NODE_ENV === 'production' && this.sdc[pathname]\n      ? Promise.resolve(this.sdc[pathname])\n      : fetchNextData(\n          pathname,\n          null,\n          this.isSsr,\n          (data) => (this.sdc[pathname] = data)\n        )\n  }\n\n  _getServerData = (asPath: string): Promise<object> => {\n    let { pathname, query } = parse(asPath, true)\n    pathname = prepareRoute(pathname!)\n    return fetchNextData(pathname, query, this.isSsr)\n  }\n\n  getInitialProps(\n    Component: ComponentType,\n    ctx: NextPageContext\n  ): Promise<any> {\n    const { Component: App } = this.components['/_app']\n    const AppTree = this._wrapApp(App)\n    ctx.AppTree = AppTree\n    return loadGetInitialProps<AppContextType<Router>>(App, {\n      AppTree,\n      Component,\n      router: this,\n      ctx,\n    })\n  }\n\n  abortComponentLoad(as: string): void {\n    if (this.clc) {\n      const e = new Error('Route Cancelled')\n      ;(e as any).cancelled = true\n      Router.events.emit('routeChangeError', e, as)\n      this.clc()\n      this.clc = null\n    }\n  }\n\n  notify(data: RouteInfo): Promise<void> {\n    return this.sub(data, this.components['/_app'].Component)\n  }\n}\n"]},"metadata":{},"sourceType":"script"}